<div class="max-w-2xl mx-auto p-4 h-screen">
<div class="mb-4">
    <%= link_to "← Вернуться к ленте", root_path, class: "text-[#ffd369] hover:underline" %>
  </div>
  <div class="bg-[#31363f] rounded-lg shadow-md p-6 mb-6">
    <div class="flex items-center mb-4">
      <div class="w-10 h-10 bg-gray-300 rounded-full mr-3"></div>
      <div>
        <h3 class="font-semibold text-[#ffd369]"><%= @post.user.email %></h3>
        <p class="text-sm text-gray-500"><%= @post.created_at.strftime("%d.%m.%Y %H:%M") %></p>
      </div>
    </div>

    <div class="mb-4">
      <p class="text-white"><%= @post.content %></p>
    </div>

    <%= turbo_frame_tag "post_#{@post.id}_likes" do %>
      <%= button_to post_like_path(@post), method: (@post.liked_by?(current_user) ? :delete : :post), class: "#{@post.liked_by?(current_user) ? 'text-red-500' : 'text-gray-500'} inline-flex items-center gap-2" do %>
        <%= heroicon("heart", variant: @post.liked_by?(current_user) ? :solid : :outline, options: { class: "w-6 h-6" }) %>
        <span><%= @post.likes.count %></span>
      <% end %>
    <% end %>
  </div>

  <div class="bg-[#31363f] rounded-lg shadow-md p-6">

    <h2 id="comments_header_<%= @post.id %>" class="text-xl text-[#ffd369] font-bold mb-4">
    Комментарии (<%= @post.comments.count %>)
  </h2>

    <%= turbo_frame_tag "post_#{@post.id}_comments" do %>
      <div class="space-y-4 mb-6">
        <% if @post.comments.any? %>
          <% @post.comments.order(created_at: :desc).each do |comment| %>
            <div id="comment_<%= comment.id %>" class="bg-[#222831] rounded-lg p-4">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <p class="font-semibold text-[#ffd369] text-sm"><%= comment.user.email %></p>
                  <p class="text-white mt-1"><%= comment.content %></p>
                  <p class="text-xs text-gray-500 mt-2"><%= comment.created_at.strftime("%d.%m.%Y %H:%M") %></p>
                </div>

                <% if current_user && comment.user == current_user %>
                  <%= button_to "✕", post_comment_path(@post, comment), method: :delete, class: "text-red-500 hover:text-red-700", data: { turbo_confirm: "Удалить комментарий?" } %>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="text-gray-500 text-center py-4">Комментариев пока нет. Будьте первым!</p>
        <% end %>
      </div>
    <% end %>

    <% if current_user %>
      <%= form_with(model: [@post, @comment], url: post_comments_path(@post), method: :post, class: "border-t border-[#ffd369] pt-4") do |f| %>
        <div class="flex gap-2">
          <%= f.text_area :content, rows: 2, placeholder: "Напишите комментарий...", class: "flex-1 border border-[#ffd369] text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#ffd369]", required: true %>
        </div>
        <div class="mt-2 flex justify-end">
          <%= f.submit "Отправить", class: "bg-[#ffd369] hover:bg-[#ffd369]/50 text-[#222831] px-6 py-2 rounded-lg cursor-pointer" %>
        </div>
      <% end %>
    <% else %>
      <p class="text-center text-gray-500 py-4">
        <%= link_to "Войдите", new_user_session_path, class: "text-blue-500 hover:underline" %>, чтобы оставить комментарий
      </p>
    <% end %>
  </div>


</div>
